{"version":3,"sources":["../../../../lib/api.ts"],"sourcesContent":["// lib/api.ts\r\nlet loadingCount = 0\r\nlet globalLoadingHandler: ((loading: boolean) => void) | null = null\r\n\r\nexport function setGlobalLoadingHandler(handler: (loading: boolean) => void) {\r\n  globalLoadingHandler = handler\r\n}\r\n\r\nexport async function apiFetch(\r\n  endpoint: string,\r\n  options: RequestInit = {},\r\n  token?: string,\r\n  withLoading: boolean = false\r\n) {\r\n  try {\r\n    if (withLoading) {\r\n      loadingCount++\r\n      globalLoadingHandler?.(true)\r\n    }\r\n\r\n    const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}${endpoint}`, {\r\n      ...options,\r\n      headers: {\r\n        \"Accept\": \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n        ...options.headers,\r\n      },\r\n    })\r\n\r\n    let data: any = null\r\n    try {\r\n      data = await res.json()\r\n    } catch { }\r\n\r\n    if (!res.ok) throw data || { message: \"Terjadi kesalahan server\" }\r\n\r\n    return data\r\n  } finally {\r\n    if (withLoading) {\r\n      loadingCount--\r\n      if (loadingCount === 0) {\r\n        globalLoadingHandler?.(false)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport async function fetchProducts(params?: URLSearchParams) {\r\n  const url = `${process.env.NEXT_PUBLIC_API_URL}/products${params ? `?${params}` : \"\"}`\r\n\r\n  const res = await fetch(url, {\r\n    cache: \"no-store\"\r\n  })\r\n\r\n  if (!res.ok) {\r\n    throw new Error(\"Failed to fetch products\")\r\n  }\r\n\r\n  return res.json()\r\n}\r\n\r\nexport async function fetchProduct(slug: string) {\r\n  const res = await fetch(\r\n    `${process.env.NEXT_PUBLIC_API_URL}/products/${slug}`,\r\n    { cache: \"no-store\" }\r\n  )\r\n\r\n  if (!res.ok) return null\r\n  const json = await res.json()\r\n  return json.data ?? null\r\n}\r\n\r\n\r\n\r\nexport async function fetchCategories() {\r\n  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/product-categories`, {\r\n    cache: \"no-store\",\r\n  })\r\n\r\n  if (!res.ok) throw new Error(\"Failed to fetch categories\")\r\n\r\n  return res.json()\r\n}\r\n\r\n\r\n\r\nexport async function validateCartAPI(\r\n  items: {\r\n    productId: number\r\n    variantId: number | null\r\n    quantity: number\r\n  }[],\r\n  token?: string\r\n) {\r\n  return apiFetch(\r\n    `/cart/validate`,\r\n    {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        items: items.map(i => ({\r\n          product_id: i.productId,\r\n          product_variant_id: i.variantId,\r\n          quantity: i.quantity,\r\n        })),\r\n      }),\r\n    },\r\n    token\r\n  )\r\n}\r\nexport const addCartAPI = async (\r\n  token: string,\r\n  item: {\r\n    productId: number\r\n    variantId: number | null\r\n    quantity: number\r\n  }\r\n) => {\r\n  return apiFetch(\r\n    \"/cart\",\r\n    {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        items: [\r\n          {\r\n            product_id: item.productId,\r\n            product_variant_id: item.variantId,\r\n            quantity: item.quantity,\r\n          },\r\n        ],\r\n      }),\r\n    },\r\n    token\r\n  )\r\n}\r\n\r\nexport async function updateCartItemAPI(\r\n  cartItemId: number,\r\n  quantity: number,\r\n  token: string\r\n) {\r\n  return apiFetch(\r\n    `/cart/${cartItemId}`,\r\n    {\r\n      method: \"PUT\",\r\n      body: JSON.stringify({ quantity }),\r\n    },\r\n    token,\r\n    true\r\n  )\r\n}\r\n\r\n\r\nexport async function deleteCartItemAPI(\r\n  cartItemId: number,\r\n  token: string\r\n) {\r\n  return apiFetch(\r\n    `/cart/${cartItemId}`,\r\n    { method: \"DELETE\" },\r\n    token,\r\n    true\r\n  )\r\n}\r\n\r\n\r\nexport async function clearCartAPI (token?: string) {\r\n  return apiFetch(\r\n    \"/cart/clear\",\r\n    {\r\n      method: \"DELETE\",\r\n    },\r\n    token,\r\n    true\r\n  )\r\n}\r\n\r\nexport const getMyOrdersAPI = async (token?: string) => {\r\n  return apiFetch(\"/orders/my\", {\r\n    method: \"GET\",\r\n  }, token)\r\n}\r\n\r\nexport async function getOrderDetailAPI( orderNumber: string, token?: string ) {\r\n  return apiFetch(\r\n    `/orders/${orderNumber}`,\r\n    { method: \"GET\" },\r\n    token\r\n  )\r\n}\r\n\r\n\r\n\r\n\r\n\r\n"],"names":[],"mappings":"8KAiDO,eAAe,EAAc,CAAwB,EAC1D,IAAM,EAAM,2CAA8C,EAAS,CAAC,CAAC,EAAE,EAAA,CAAQ,CAAG,IAAI,CAEhF,EAAM,MAAM,KAF6B,CAEvB,EAAK,CAC3B,KAHsD,CAG/C,UACT,GAEA,GAAI,CAAC,EAAI,EAAE,CACT,CADW,KACL,AAAI,MAAM,4BAGlB,OAAO,EAAI,IAAI,EACjB,CAEO,eAAe,EAAa,CAAY,EAC7C,IAAM,EAAM,MAAM,MAChB,4CAA+C,GAAM,CACrD,CAAE,MAAO,UAAW,MADe,IAIrC,AAAK,EAAI,EAAL,AAAO,CAEJ,CANwC,AAIlC,AACA,MAAM,EAAI,IAAI,EAAA,EACf,IAAI,EAAI,KAFA,IAGtB"}