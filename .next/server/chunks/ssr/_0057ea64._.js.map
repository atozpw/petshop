{"version":3,"sources":["../../../../lib/api.ts"],"sourcesContent":["// lib/api.ts\nlet loadingCount = 0\nlet globalLoadingHandler: ((loading: boolean) => void) | null = null\n\nexport function setGlobalLoadingHandler(handler: (loading: boolean) => void) {\n  globalLoadingHandler = handler\n}\n\nexport async function apiFetch(\n  endpoint: string,\n  options: RequestInit = {},\n  token?: string,\n  withLoading: boolean = false\n) {\n  try {\n    if (withLoading) {\n      loadingCount++\n      globalLoadingHandler?.(true)\n    }\n\n    const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}${endpoint}`, {\n      ...options,\n      headers: {\n        \"Accept\": \"application/json\",\n        \"Content-Type\": \"application/json\",\n        ...(token ? { Authorization: `Bearer ${token}` } : {}),\n        ...options.headers,\n      },\n    })\n\n    let data: any = null\n    try {\n      data = await res.json()\n    } catch { }\n\n    if (!res.ok) throw data || { message: \"Terjadi kesalahan server\" }\n\n    return data\n  } finally {\n    if (withLoading) {\n      loadingCount--\n      if (loadingCount === 0) {\n        globalLoadingHandler?.(false)\n      }\n    }\n  }\n}\n\n\nexport async function fetchProducts(params?: URLSearchParams) {\n  const url = `${process.env.NEXT_PUBLIC_API_URL}/products${params ? `?${params}` : \"\"}`\n\n  const res = await fetch(url, {\n    cache: \"no-store\"\n  })\n\n  if (!res.ok) {\n    throw new Error(\"Failed to fetch products\")\n  }\n\n  return res.json()\n}\n\nexport async function fetchProduct(slug: string) {\n  const res = await fetch(\n    `${process.env.NEXT_PUBLIC_API_URL}/products/${slug}`,\n    { cache: \"no-store\" }\n  )\n\n  if (!res.ok) return null\n  const json = await res.json()\n  return json.data ?? null\n}\n\n\n\nexport async function fetchCategories() {\n  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/product-categories`, {\n    cache: \"no-store\",\n  })\n\n  if (!res.ok) throw new Error(\"Failed to fetch categories\")\n\n  return res.json()\n}\n\n\n\nexport async function validateCartAPI(\n  items: {\n    productId: number\n    variantId: number | null\n    quantity: number\n  }[],\n  token?: string\n) {\n  return apiFetch(\n    `/cart/validate`,\n    {\n      method: \"POST\",\n      body: JSON.stringify({\n        items: items.map(i => ({\n          product_id: i.productId,\n          product_variant_id: i.variantId,\n          quantity: i.quantity,\n        })),\n      }),\n    },\n    token\n  )\n}\nexport const addCartAPI = async (\n  token: string,\n  item: {\n    productId: number\n    variantId: number | null\n    quantity: number\n  }\n) => {\n  return apiFetch(\n    \"/cart\",\n    {\n      method: \"POST\",\n      body: JSON.stringify({\n        items: [\n          {\n            product_id: item.productId,\n            product_variant_id: item.variantId,\n            quantity: item.quantity,\n          },\n        ],\n      }),\n    },\n    token\n  )\n}\n\nexport async function updateCartItemAPI(\n  cartItemId: number,\n  quantity: number,\n  token: string\n) {\n  return apiFetch(\n    `/cart/${cartItemId}`,\n    {\n      method: \"PUT\",\n      body: JSON.stringify({ quantity }),\n    },\n    token,\n    true\n  )\n}\n\n\nexport async function deleteCartItemAPI(\n  cartItemId: number,\n  token: string\n) {\n  return apiFetch(\n    `/cart/${cartItemId}`,\n    { method: \"DELETE\" },\n    token,\n    true\n  )\n}\n\n\nexport async function clearCartAPI (token?: string) {\n  return apiFetch(\n    \"/cart/clear\",\n    {\n      method: \"DELETE\",\n    },\n    token,\n    true\n  )\n}\n\nexport const getMyOrdersAPI = async (token?: string) => {\n  return apiFetch(\"/orders/my\", {\n    method: \"GET\",\n  }, token)\n}\n\nexport async function getOrderDetailAPI( orderNumber: string, token?: string ) {\n  return apiFetch(\n    `/orders/${orderNumber}`,\n    { method: \"GET\" },\n    token\n  )\n}\n\n\n\n\n\n"],"names":[],"mappings":"8KAiDO,eAAe,EAAc,CAAwB,EAC1D,IAAM,EAAM,4CAA8C,EAAS,CAAC,CAAC,EAAE,EAAA,CAAQ,CAAG,IAAI,CAEhF,EAAM,MAAM,KAF6B,CAEvB,EAAK,CAC3B,KAHsD,CAG/C,UACT,GAEA,GAAI,CAAC,EAAI,EAAE,CACT,CADW,KACL,AAAI,MAAM,4BAGlB,OAAO,EAAI,IAAI,EACjB,CAEO,eAAe,EAAa,CAAY,EAC7C,IAAM,EAAM,MAAM,MAChB,6CAA+C,GAAM,CACrD,CAAE,MAAO,UAAW,MADe,IAIrC,AAAK,EAAI,EAAL,AAAO,CAEJ,CANwC,AAIlC,AACA,MAAM,EAAI,IAAI,EAAA,EACf,IAAI,EAAI,KAFA,IAGtB"}